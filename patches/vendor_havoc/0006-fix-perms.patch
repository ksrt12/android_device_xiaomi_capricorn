From a677a5e7da4d299406bfb7ec8376473846630901 Mon Sep 17 00:00:00 2001
From: Kazakov Stepan <kazakov12stepan2012@live.ru>
Date: Thu, 1 Nov 2018 20:54:24 +0300
Subject: [PATCH] fix perms

Signed-off-by: Kazakov Stepan <ksrt12group@gmail.com>
---
 build/tasks/dtbo.mk                           | 37 -------------------
 config/BoardConfigHavoc.mk                    |  2 +-
 config/common.mk                              |  2 +-
 config/version.mk                             |  1 -
 .../permissions/privapp-permissions-turbo.xml | 27 ++++++++++++++
 5 files changed, 29 insertions(+), 40 deletions(-)
 delete mode 100644 build/tasks/dtbo.mk

diff --git a/build/tasks/dtbo.mk b/build/tasks/dtbo.mk
deleted file mode 100644
index dc3a98ac..00000000
--- a/build/tasks/dtbo.mk
+++ /dev/null
@@ -1,37 +0,0 @@
-ifneq ($(TARGET_NO_KERNEL),true)
-ifeq ($(strip $(BOARD_KERNEL_SEPARATED_DTBO)),true)
-
-MKDTIMG := $(HOST_OUT_EXECUTABLES)/mkdtimg$(HOST_EXECUTABLE_SUFFIX)
-
-INSTALLED_DTBOIMAGE_TARGET := $(PRODUCT_OUT)/dtbo.img
-
-# Most specific paths must come first in possible_dtbo_dirs
-possible_dtbo_dirs = $(KERNEL_OUT)/arch/$(KERNEL_ARCH)/boot/dts $(KERNEL_OUT)/arch/arm/boot/dts
-
-define build-dtboimage-target
-    $(call pretty,"Target dtbo image: $(INSTALLED_DTBOIMAGE_TARGET)")
-    $(hide) for dir in $(possible_dtbo_dirs); do \
-                if [ -d "$$dir" ]; then \
-                    dtbo_dir="$$dir"; \
-                    break; \
-                fi; \
-            done; \
-            $(MKDTIMG) create $@ --page_size=$(BOARD_KERNEL_PAGESIZE) $$(find "$$dtbo_dir" -name '*.dtbo')
-    $(hide) chmod a+r $@
-endef
-
-ifeq ($(BOARD_AVB_ENABLE),true)
-$(INSTALLED_DTBOIMAGE_TARGET): $(AVBTOOL) $(BOARD_AVB_DTBO_KEY_PATH) $(MKDTIMG) $(INSTALLED_KERNEL_TARGET)
-	$(build-dtboimage-target)
-	$(AVBTOOL) add_hash_footer \
-		--image $@ \
-		--partition_size $(BOARD_DTBOIMG_PARTITION_SIZE) \
-		--partition_name dtbo $(INTERNAL_AVB_DTBO_SIGNING_ARGS) \
-		$(BOARD_AVB_DTBO_ADD_HASH_FOOTER_ARGS)
-else
-$(INSTALLED_DTBOIMAGE_TARGET): $(MKDTIMG) $(INSTALLED_KERNEL_TARGET)
-	$(build-dtboimage-target)
-endif
-
-endif # BOARD_KERNEL_SEPARATED_DTBO
-endif # TARGET_NO_KERNEL
diff --git a/config/BoardConfigHavoc.mk b/config/BoardConfigHavoc.mk
index 33be6de4..1030d135 100644
--- a/config/BoardConfigHavoc.mk
+++ b/config/BoardConfigHavoc.mk
@@ -4,5 +4,5 @@ ifeq ($(WITH_HAVOC_CHARGER),true)
 endif
 
 ifeq ($(BOARD_USES_QCOM_HARDWARE),true)
-include vendor/havoc/config/BoardConfigQcom.mk
+#include vendor/havoc/config/BoardConfigQcom.mk
 endif
diff --git a/config/common.mk b/config/common.mk
index 59db4989..dcf30cbf 100644
--- a/config/common.mk
+++ b/config/common.mk
@@ -296,7 +296,7 @@ ifeq ($(HOST_OS),linux)
 endif
 
 # Bootanimation
-include vendor/havoc/config/bootanimation.mk
+#include vendor/havoc/config/bootanimation.mk
 
 # Version
 include vendor/havoc/config/version.mk
diff --git a/config/version.mk b/config/version.mk
index d5c205a7..56d480c7 100644
--- a/config/version.mk
+++ b/config/version.mk
@@ -22,7 +22,6 @@ HAVOC_MOD_VERSION := Havoc-OS-$(HAVOC_BASE_VERSION)-$(HAVOC_BUILD_DATE)-$(HAVOC_
 ROM_FINGERPRINT := Havoc-OS/$(HAVOC_BASE_VERSION)/$(PLATFORM_VERSION)/$(TARGET_PRODUCT_SHORT)/$(HAVOC_BUILD_DATE)
 
 PRODUCT_PROPERTY_OVERRIDES += \
-    BUILD_DISPLAY_ID=$(BUILD_ID) \
     ro.havoc.build.version=$(HAVOC_BUILD_VERSION) \
     ro.havoc.version=$(HAVOC_VERSION) \
     ro.havoc.releasetype=$(HAVOC_BUILD_TYPE) \
diff --git a/prebuilt/common/etc/permissions/privapp-permissions-turbo.xml b/prebuilt/common/etc/permissions/privapp-permissions-turbo.xml
index 2be143b0..e4b4fe18 100644
--- a/prebuilt/common/etc/permissions/privapp-permissions-turbo.xml
+++ b/prebuilt/common/etc/permissions/privapp-permissions-turbo.xml
@@ -10,4 +10,31 @@
         <permission name="android.permission.SUBSTITUTE_NOTIFICATION_APP_NAME"/>
     </privapp-permissions>
 
+    <privapp-permissions package="com.google.android.apps.wallpaper">
+        <permission name="android.permission.READ_WALLPAPER_INTERNAL"/>
+    </privapp-permissions>
+
+    <privapp-permissions package="com.google.android.apps.nexuslauncher">
+        <permission name="android.permission.PACKAGE_USAGE_STATS"/>
+        <permission name="android.permission.WRITE_SECURE_SETTINGS"/>
+        <permission name="android.permission.BIND_APPWIDGET"/>
+        <permission name="android.permission.CONTROL_REMOTE_APP_TRANSITION_ANIMATIONS"/>
+    </privapp-permissions>
+
+    <privapp-permissions package="com.havoc.ota">
+        <permission name="android.permission.ACCESS_CACHE_FILESYSTEM"/>
+        <permission name="android.permission.REBOOT"/>
+        <permission name="android.permission.RECOVERY"/>
+    </privapp-permissions>
+
+    <privapp-permissions package="org.omnirom.omniswitch">
+        <permission name="android.permission.CHANGE_OVERLAY_PACKAGES"/>
+        <permission name="android.permission.FORCE_STOP_PACKAGES"/>
+        <permission name="android.permission.MANAGE_ACTIVITY_STACKS"/>
+        <permission name="android.permission.MANAGE_USERS"/>
+        <permission name="android.permission.READ_FRAME_BUFFER"/>
+        <permission name="android.permission.REAL_GET_TASKS"/> 
+        <permission name="android.permission.START_TASKS_FROM_RECENTS"/>
+        <permission name="android.permission.STOP_APP_SWITCHES"/>
+    </privapp-permissions>
 </permissions>
-- 
2.19.1

